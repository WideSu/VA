---
title: "Take Home Exercise 3"
author:
- name: "Huang Anni"
  affiliation: "Singapore Management University"
description: |
  VAST Challenge 3
output:
  distill::distill_article:
    toc: true
    toc_depth: 3
---

# The task
With reference to Challenge 3 of VAST Challenge 2022, you are required to reveal the economic of the city of Engagement, Ohio USA by using appropriate static and interactive statistical graphics methods


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      warning = FALSE, 
                      message = FALSE)
```

# Introduction
  
This exercise requires us to apply the skills you had learned in Lesson 1 and Hands-on Exercise 1 to reveal the demographic of the city of Engagement, Ohio USA by using appropriate static statistical graphics methods. The data should be processed by using appropriate tidyverse family of packages and the statistical graphics must be prepared using ggplot2 and its extensions.
![image](https://user-images.githubusercontent.com/44923423/166912984-6b798c62-f22e-4566-ac08-ad74e02af498.png)

  
```{r include=FALSE}
packages = c('ggiraph', 'plotly', 'tidyverse', 'DT','gganimate',
             'knitr', 'ggdist', 'scales', 'grid', 'gridExtra',
             'patchwork','ggsignif','gghighlight',"hrbrthemes",
             'readxl', 'gifski', 'gapminder','treemap', 'treemapify',
             'rPackedBar')
print(length(packages))

for(p in packages) {
  if(!require(p, character.only = T)) {
    install.packages(p)
  }
  library(p, character.only = T)
}
```

```{r load data, include=FALSE, preview=TRUE}
library(tidyverse)
library(ggplot2)
financial <- read_csv('./data/FinancialJournal.csv')
glimpse(financial)
```
```{r}
y <- as.POSIXct(financial$timestamp, format="%Y-%m-%d %H:%M:%S")
financial$year <- format(y, format="%Y")
financial$month <- format(y, format="%m")

income <- financial %>%
  filter(category %in% c('Wage', 'RentAdjustment')) %>%
  group_by(year, month) %>%
  summarise(income = sum(amount))

outcome <- financial %>%
  filter(!category %in% c('Wage', 'RentAdjustment')) %>%
  group_by(year, month) %>%
  summarise(outcome = sum(abs(amount)))
total <- merge(income,outcome,by=c("year","month"))
total$date <- paste(total$year, total$month, sep='-')
total$coef <- total$outcome / total$income
unique(total$date)
library(rmarkdown)
paged_table(financial, options = list(rows.print = 15, cols.print = 5))
total$coef <- total$outcome/total$income
p1 <- ggplot(data=total) + aes(x=date, y=coef,group=1) +
  geom_line(color='black')+
  geom_point(color="black", fill="grey") +
  labs(y= 'Spend/Income', x= 'Date',
       title = "Fig 1.Residence's living status through time",
       subtitle = "Highest standards in 2022-04") +
  theme(axis.title.y= element_text(angle=90),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        axis.ticks.x= element_blank(),
        panel.background= element_blank(), 
        axis.line= element_line(color= 'grey'),
        panel.grid.major.y = element_line(color = "grey",
                                  size = 0.75,
                                  linetype = 2))
girafe(
  ggobj = p1,
  width_svg = 6,
  height_svg = 6*0.618,
  options = list(
    opts_hover_inv(css = "stroke-width: 1;opacity:0.6;"),
    opts_hover(css = "stroke-width: 4; opacity: 1;"))
)
```
```{r}
fig <- plot_ly(total, x = ~date, y = ~coef, type = 'scatter',mode = 'lines+markers')
fig <- fig %>% layout(title = 'Fig 1.Residence\'s living status through time')
fig
```
```{r}
total$remain <- total$income - total$outcome
p1 <- ggplot(data=total) + aes(x=date) +
  geom_bar(color="black", fill="grey") +
  labs(y= 'Income-speed', x= 'Date',
       title = "Fig 1.Residence's living status through time",
       subtitle = "Highest standards in 2022-04") +
  theme(axis.title.y= element_text(angle=90),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        axis.ticks.x= element_blank(),
        panel.background= element_blank(), 
        panel.grid.major.y = element_line(color = "grey",
                                  size = 0.75,
                                  linetype = 2))
p1
```


